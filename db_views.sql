
--
-- Structure for view `calculation_sheet_view`
--
DROP TABLE IF EXISTS `calculation_sheet_view`;

CREATE VIEW `calculation_sheet_view`  AS  select `trips_details_upper_layer_view`.`trip_id` AS `trip_id`,`trips_details_upper_layer_view`.`trip_detail_id` AS `trip_detail_id`,`trips_details_upper_layer_view`.`shortage_quantity` AS `shortage_quantity`,`trips_details_upper_layer_view`.`shortage_rate` AS `shortage_rate`,`trips_details_upper_layer_view`.`shortage_id` AS `shortage_id`,`trips_details_upper_layer_view`.`dis_qty` AS `dis_qty`,`trips_details_upper_layer_view`.`rec_qty` AS `rec_qty`,`trips_details_upper_layer_view`.`source_city_name` AS `source_city_name`,`trips_details_upper_layer_view`.`source_id` AS `source_id`,`trips_details_upper_layer_view`.`destination_city_name` AS `destination_city_name`,`trips_details_upper_layer_view`.`destination_id` AS `destination_id`,`trips_details_upper_layer_view`.`invoice_date` AS `invoice_date`,`trips_details_upper_layer_view`.`invoice_number` AS `invoice_number`,`trips_details_upper_layer_view`.`company_id` AS `company_id`,`trips_details_upper_layer_view`.`customer_id` AS `customer_id`,`trips_details_upper_layer_view`.`contractor_id` AS `contractor_id`,`trips_details_upper_layer_view`.`product_id` AS `product_id`,`trips_details_upper_layer_view`.`tanker_number` AS `tanker_number`,`trips_details_upper_layer_view`.`contractor_name` AS `contractor_name`,`trips_details_upper_layer_view`.`company_name` AS `company_name`,`trips_details_upper_layer_view`.`customer_freight_unit` AS `customer_freight_unit`,`trips_details_upper_layer_view`.`company_freight_unit` AS `company_freight_unit`,`trips_details_upper_layer_view`.`wht` AS `wht`,`trips_details_upper_layer_view`.`product_type` AS `product_type`,`trips_details_upper_layer_view`.`productName` AS `productName`,`trips_details_upper_layer_view`.`entryDate` AS `entryDate`,`trips_details_upper_layer_view`.`stn_number` AS `stn_number`,`trips_details_upper_layer_view`.`bill_id` AS `bill_id`,`trips_details_upper_layer_view`.`product_id` AS `product`,`trips_details_upper_layer_view`.`trip_detail_id` AS `detail_id`,`trips_details_upper_layer_view`.`wht` AS `tax` from `trips_details_upper_layer_view` ;

-- --------------------------------------------------------

--
-- Structure for view `decanding_shortages_view`
--
DROP TABLE IF EXISTS `decanding_shortages_view`;

CREATE VIEW `decanding_shortages_view`  AS  select `trips`.`id` AS `trip_id`,`trips`.`entryDate` AS `trip_entry_date`,`shortages`.`id` AS `shortage_id`,`shortages`.`trip_detail_id` AS `trip_detail_id`,`tankers`.`id` AS `tanker_id`,`shortages`.`quantity` AS `quantity`,`shortages`.`rate` AS `rate`,round((`shortages`.`rate` * `shortages`.`quantity`),2) AS `shortage_amount`,`shortages`.`date` AS `date`,`source_city`.`cityName` AS `source`,`destination_city`.`cityName` AS `destination`,`products`.`productName` AS `product_name`,`products`.`id` AS `product_id`,`source_city`.`id` AS `source_id`,`destination_city`.`id` AS `destination_id`,`customers`.`id` AS `customer_id`,`customers`.`name` AS `customer_name`,`companies`.`id` AS `companies_id`,`companies`.`name` AS `company_name`,`carriage_contractors`.`id` AS `contractor_id`,`carriage_contractors`.`name` AS `contractor_name`,(case when isnull(`voucher_journal`.`id`) then '0' else (case when (`voucher_journal`.`active` = 1) then 1 else 0 end) end) AS `committed` from ((((((((((`shortages` left join `voucher_journal` on((`voucher_journal`.`shortage_id` = `shortages`.`id`))) join `trips_details` on((`trips_details`.`id` = `shortages`.`trip_detail_id`))) join `trips` on((`trips`.`id` = `trips_details`.`trip_id`))) join `products` on((`products`.`id` = `trips_details`.`product`))) join `cities` `source_city` on((`source_city`.`id` = `trips_details`.`source`))) join `cities` `destination_city` on((`destination_city`.`id` = `trips_details`.`destination`))) join `customers` on((`customers`.`id` = `trips`.`customer_id`))) join `carriage_contractors` on((`carriage_contractors`.`id` = `trips`.`contractor_id`))) join `companies` on((`companies`.`id` = `trips`.`company_id`))) join `tankers` on((`tankers`.`id` = `trips`.`tanker_id`))) where ((`trips`.`active` = 1) and (`shortages`.`type` = 2)) ;

-- --------------------------------------------------------

--
-- Structure for view `destination_shortages_view`
--
DROP TABLE IF EXISTS `destination_shortages_view`;

CREATE VIEW `destination_shortages_view`  AS  select `trips`.`id` AS `trip_id`,`trips`.`entryDate` AS `trip_entry_date`,`shortages`.`id` AS `shortage_id`,`shortages`.`trip_detail_id` AS `trip_detail_id`,`tankers`.`id` AS `tanker_id`,`shortages`.`quantity` AS `quantity`,`shortages`.`rate` AS `rate`,round((`shortages`.`rate` * `shortages`.`quantity`),2) AS `shortage_amount`,`shortages`.`date` AS `date`,`source_city`.`cityName` AS `source`,`destination_city`.`cityName` AS `destination`,`products`.`productName` AS `product_name`,`products`.`id` AS `product_id`,`source_city`.`id` AS `source_id`,`destination_city`.`id` AS `destination_id`,`customers`.`id` AS `customer_id`,`customers`.`name` AS `customer_name`,`companies`.`id` AS `companies_id`,`companies`.`name` AS `company_name`,`carriage_contractors`.`id` AS `contractor_id`,`carriage_contractors`.`name` AS `contractor_name`,(case when isnull(`voucher_journal`.`id`) then '0' else (case when (`voucher_journal`.`active` = 1) then 1 else 0 end) end) AS `committed` from ((((((((((`shortages` left join `voucher_journal` on((`voucher_journal`.`shortage_id` = `shortages`.`id`))) join `trips_details` on((`trips_details`.`id` = `shortages`.`trip_detail_id`))) join `trips` on((`trips`.`id` = `trips_details`.`trip_id`))) join `products` on((`products`.`id` = `trips_details`.`product`))) join `cities` `source_city` on((`source_city`.`id` = `trips_details`.`source`))) join `cities` `destination_city` on((`destination_city`.`id` = `trips_details`.`destination`))) join `customers` on((`customers`.`id` = `trips`.`customer_id`))) join `carriage_contractors` on((`carriage_contractors`.`id` = `trips`.`contractor_id`))) join `companies` on((`companies`.`id` = `trips`.`company_id`))) join `tankers` on((`tankers`.`id` = `trips`.`tanker_id`))) where ((`trips`.`active` = 1) and (`shortages`.`type` = 1)) ;

-- --------------------------------------------------------

--
-- Structure for view `dr_cr_status_for_manage_accounts_view`
--
DROP TABLE IF EXISTS `dr_cr_status_for_manage_accounts_view`;

CREATE VIEW `dr_cr_status_for_manage_accounts_view`  AS  select `union_of_automatic_and_mass_vouchers`.`voucher_id` AS `voucher_id`,`union_of_automatic_and_mass_vouchers`.`trip_detail_id` AS `trip_detail_id`,`voucher_entry`.`account_title_id` AS `account_title_id`,`account_titles`.`title` AS `account_title`,`voucher_entry`.`dr_cr` AS `dr_cr` from (((`union_of_automatic_and_mass_vouchers` left join `voucher_journal` on((`voucher_journal`.`id` = `union_of_automatic_and_mass_vouchers`.`voucher_id`))) join `voucher_entry` on((`voucher_entry`.`journal_voucher_id` = `voucher_journal`.`id`))) left join `account_titles` on((`account_titles`.`id` = `voucher_entry`.`account_title_id`))) where (`voucher_journal`.`active` = '1') ;

-- --------------------------------------------------------

--
-- Structure for view `incomplete_trips_view`
--
DROP TABLE IF EXISTS `incomplete_trips_view`;

CREATE VIEW `incomplete_trips_view`  AS  select `trips`.`id` AS `trip_id`,`trips`.`tanker_id` AS `tanker_id`,`trips`.`entryDate` AS `entryDate`,`source_city`.`id` AS `source_id`,`source_city`.`cityName` AS `source`,`destination_city`.`id` AS `destination_id`,`destination_city`.`cityName` AS `destination`,`products`.`id` AS `product_id`,`products`.`productName` AS `product`,`trips`.`customer_id` AS `customer_id`,`trips`.`contractor_id` AS `contractor_id`,`trips`.`company_id` AS `company_id`,`customers`.`name` AS `customer_name` from (((((`trips` join `trips_details` on((`trips_details`.`trip_id` = `trips`.`id`))) left join `customers` on((`customers`.`id` = `trips`.`customer_id`))) join `cities` `source_city` on((`source_city`.`id` = `trips_details`.`source`))) join `cities` `destination_city` on((`destination_city`.`id` = `trips_details`.`destination`))) join `products` on((`products`.`id` = `trips_details`.`product`))) where ((`trips_details`.`stn_number` = '') and (`trips`.`active` = 1)) ;

-- --------------------------------------------------------

--
-- Structure for view `manage_accounts_black_oil_view`
--
DROP TABLE IF EXISTS `manage_accounts_black_oil_view`;

CREATE VIEW `manage_accounts_black_oil_view`  AS  select `td`.`trip_id` AS `trip_id`,`td`.`trip_detail_id` AS `trip_detail_id`,`td`.`trip_sub_type` AS `trip_sub_type`,`td`.`type` AS `trip_type_id`,`td`.`stn_number` AS `stn_number`,`td`.`trip_type` AS `trip_type`,`td`.`entryDate` AS `trip_date`,`td`.`source_city_name` AS `source`,`td`.`source_id` AS `source_id`,`td`.`destination_city_name` AS `destination`,`td`.`destination_id` AS `destination_id`,`td`.`invoice_date` AS `invoice_date`,`td`.`invoice_number` AS `invoice_number`,`td`.`tanker_id` AS `tanker_id`,`td`.`tanker_number` AS `tanker_number`,`td`.`productName` AS `product`,`td`.`product_id` AS `product_id`,`td`.`dis_qty` AS `dis_qty`,`td`.`rec_qty` AS `rec_qty`,`td`.`shortage_quantity` AS `shortage_quantity`,(`td`.`dis_qty` * `td`.`company_freight_unit`) AS `total_freight_cmp`,`td`.`shortage_rate` AS `shortage_rate`,(`td`.`shortage_quantity` * `td`.`shortage_rate`) AS `shortage_amount`,(`td`.`company_freight_unit` * `td`.`shortage_quantity`) AS `freight_on_shortage_qty_cmp`,(`td`.`customer_freight_unit` * `td`.`shortage_quantity`) AS `freight_on_shortage_qty_cst`,`td`.`customer_freight_unit` AS `customer_freight_unit`,`td`.`company_freight_unit` AS `company_freight_unit`,`td`.`company_name` AS `company`,`td`.`company_id` AS `company_id`,(((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`)) - (`td`.`shortage_quantity` * `td`.`shortage_rate`)) AS `payable_before_tax`,`td`.`wht` AS `wht`,((`td`.`wht` * ((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`))) / 100) AS `wht_amount`,((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`)) AS `freight_amount_cmp`,((((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`)) - (`td`.`shortage_quantity` * `td`.`shortage_rate`)) - ((`td`.`wht` * ((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`))) / 100)) AS `net_payables`,((`td`.`company_commission` * ((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`))) / 100) AS `company_commission_amount`,(((((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`)) - (`td`.`shortage_quantity` * `td`.`shortage_rate`)) - ((`td`.`wht` * ((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`))) / 100)) - ((`td`.`company_commission` * ((`td`.`dis_qty` * `td`.`company_freight_unit`) - (`td`.`company_freight_unit` * `td`.`shortage_quantity`))) / 100)) AS `contractor_net_freight`,`td`.`company_commission` AS `company_commission`,((`td`.`contractor_commission` - `td`.`wht`) - `td`.`company_commission`) AS `contractor_commission`,((((`td`.`contractor_commission` - `td`.`wht`) - `td`.`company_commission`) * ((`td`.`dis_qty` * `td`.`customer_freight_unit`) - (`td`.`customer_freight_unit` * `td`.`shortage_quantity`))) / 100) AS `contractor_commission_amount`,`td`.`contractor_name` AS `contractor`,`td`.`contractor_id` AS `contractor_id`,(`td`.`dis_qty` * `td`.`customer_freight_unit`) AS `total_freight_cst`,((`td`.`dis_qty` * `td`.`customer_freight_unit`) - (`td`.`customer_freight_unit` * `td`.`shortage_quantity`)) AS `freight_amount_cst`,(((`td`.`dis_qty` * `td`.`customer_freight_unit`) - ((`td`.`contractor_commission` * ((`td`.`dis_qty` * `td`.`customer_freight_unit`) - (`td`.`customer_freight_unit` * `td`.`shortage_quantity`))) / 100)) - ((`td`.`customer_freight_unit` * `td`.`shortage_quantity`) + (`td`.`shortage_quantity` * `td`.`shortage_rate`))) AS `customer_freight`,`td`.`customer_name` AS `customer`,`td`.`customer_id` AS `customer_id`,`td`.`bill_id` AS `bill_id`,`td`.`trip_id` AS `service_charges`,`td`.`billed_date_time` AS `billed_date_time`,(case when (`td`.`bill_id` = '0') then 'Not Billed' else 'Billed' end) AS `billed` from `trips_details_upper_layer_view` `td` where (`td`.`product_type` = 'black oil') order by `td`.`trip_id` desc ;

-- --------------------------------------------------------

--
-- Structure for view `manage_accounts_white_oil_view`
--
DROP TABLE IF EXISTS `manage_accounts_white_oil_view`;

CREATE VIEW `manage_accounts_white_oil_view`  AS  select `trips_details`.`trip_id` AS `trip_id`,`trips_details`.`trip_detail_id` AS `trip_detail_id`,`trips_details`.`type` AS `trip_type_id`,`trips_details`.`trip_type` AS `trip_type`,`trips_details`.`trip_sub_type` AS `trip_sub_type`,`trips_details`.`entryDate` AS `trip_date`,`trips_details`.`product_id` AS `product_id`,`trips_details`.`tanker_id` AS `tanker_id`,`trips_details`.`tanker_number` AS `tanker_number`,`trips_details`.`productName` AS `productName`,`trips_details`.`dis_qty` AS `product_quantity`,round((`trips_details`.`shortage_quantity` * `trips_details`.`shortage_rate`),2) AS `shortage_amount`,`trips_details`.`source_city_name` AS `source`,`trips_details`.`source_id` AS `source_id`,`trips_details`.`destination_city_name` AS `destination`,`trips_details`.`destination_id` AS `destination_id`,`trips_details`.`stn_number` AS `stn_number`,`trips_details`.`company_name` AS `company`,`trips_details`.`company_id` AS `company_id`,`trips_details`.`contractor_id` AS `contractor_id`,`trips_details`.`customer_id` AS `customer_id`,`trips_details`.`company_freight_unit` AS `company_freight_unit`,round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2) AS `total_freight_cmp`,`trips_details`.`wht` AS `wht`,round(((`trips_details`.`wht` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2) AS `wht_amount`,`trips_details`.`company_commission` AS `company_commission`,round(((`trips_details`.`company_commission` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2) AS `company_commission_amount`,`trips_details`.`contractor_name` AS `contractor`,(100 - `trips_details`.`wht`) AS `contractor_freight`,(round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2) - round(((`trips_details`.`wht` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2)) AS `contractor_freight_amount`,((round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2) - round(((`trips_details`.`wht` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2)) - round((`trips_details`.`shortage_quantity` * `trips_details`.`shortage_rate`),2)) AS `contractor_freight_without_shortage`,((round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2) - round(((`trips_details`.`wht` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2)) - round(((`trips_details`.`company_commission` * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2)) AS `contractor_net_freight`,((`trips_details`.`contractor_commission` - `trips_details`.`wht`) - `trips_details`.`company_commission`) AS `contractor_commission`,round(((((`trips_details`.`contractor_commission` - `trips_details`.`wht`) - `trips_details`.`company_commission`) * round((`trips_details`.`dis_qty` * `trips_details`.`company_freight_unit`),2)) / 100),2) AS `contractor_commission_amount`,`trips_details`.`customer_name` AS `customer`,`trips_details`.`customer_freight_unit` AS `freight_unit_cst`,round((`trips_details`.`dis_qty` * `trips_details`.`customer_freight_unit`),2) AS `total_freight_cst`,(100 - `trips_details`.`contractor_commission`) AS `customer_freight`,round((((100 - `trips_details`.`contractor_commission`) * round((`trips_details`.`dis_qty` * `trips_details`.`customer_freight_unit`),2)) / 100),2) AS `customer_freight_amount`,(round((((100 - `trips_details`.`contractor_commission`) * round((`trips_details`.`dis_qty` * `trips_details`.`customer_freight_unit`),2)) / 100),2) - round((`trips_details`.`shortage_quantity` * `trips_details`.`shortage_rate`),2)) AS `customer_freight_without_shortage`,`trips_details`.`trip_id` AS `service_charges`,`trips_details`.`bill_id` AS `bill_id`,`trips_details`.`billed_date_time` AS `billed_date_time`,(case when (`trips_details`.`bill_id` = '0') then 'Not Billed' else 'Billed' end) AS `billed` from `trips_details_upper_layer_view` `trips_details` where (`trips_details`.`product_type` = 'white oil') order by `trips_details`.`trip_id` desc ;

-- --------------------------------------------------------

--
-- Structure for view `tankers_status_view`
--
DROP TABLE IF EXISTS `tankers_status_view`;

CREATE VIEW `tankers_status_view`  AS  select `tankers`.`id` AS `id`,`tankers`.`truck_number` AS `truck_number`,`tankers`.`engine_number` AS `engine_number`,`tankers`.`chase_number` AS `chase_number`,(case when (`tankers`.`fitness_certificate` = 0) then 'no' else 'yes' end) AS `fitness_certificate`,`tankers`.`capacity` AS `capacity`,(case when isnull(`trips`.`trip_id`) then `tankers`.`customerId` else `trips`.`customer_id` end) AS `customerId`,`trips`.`source` AS `source`,`trips`.`destination` AS `destination`,`trips`.`product` AS `product`,(case when isnull(`trips`.`trip_id`) then `customers`.`name` else `trips`.`customer_name` end) AS `customer`,`trips`.`trip_id` AS `trip_id`,`trips`.`entryDate` AS `trip_entry_date`,`trips`.`product_id` AS `product_id`,(case when isnull(`trips`.`trip_id`) then 'free' else 'on_move' end) AS `status` from ((`tankers` left join `incomplete_trips_view` `trips` on((`trips`.`tanker_id` = `tankers`.`id`))) left join `customers` on((`customers`.`id` = `tankers`.`customerId`))) ;

-- --------------------------------------------------------

--
-- Structure for view `trips_details_and_dest_decnd_ids`
--
DROP TABLE IF EXISTS `trips_details_and_dest_decnd_ids`;

CREATE VIEW `trips_details_and_dest_decnd_ids`  AS  select `trips_details`.`trip_id` AS `trip_id`,`trips_details`.`id` AS `trip_detail_id`,(case when (`dest_v`.`committed` = 1) then `dest_v`.`shortage_id` else NULL end) AS `dest_shortage_id`,(case when (`decnd_v`.`committed` = 1) then `decnd_v`.`shortage_id` else NULL end) AS `decnd_shortage_id`,`dest_v`.`shortage_id` AS `dest_shortage_id_for_trips_details_and_dest_decnd_ids_view`,`dest_v`.`quantity` AS `dest_quantity`,`dest_v`.`rate` AS `dest_rate`,`decnd_v`.`shortage_id` AS `decnd_shortage_id_for_trips_details_and_dest_decnd_ids_view`,`decnd_v`.`quantity` AS `decnd_quantity`,`decnd_v`.`rate` AS `decnd_rate` from (((`trips_details` left join `trips` on((`trips`.`id` = `trips_details`.`trip_id`))) left join `decanding_shortages_view` `decnd_v` on((`decnd_v`.`trip_detail_id` = `trips_details`.`id`))) left join `destination_shortages_view` `dest_v` on((`dest_v`.`trip_detail_id` = `trips_details`.`id`))) where (`trips`.`active` = 1) ;

-- --------------------------------------------------------

--
-- Structure for view `trips_details_upper_layer_view`
--
DROP TABLE IF EXISTS `trips_details_upper_layer_view`;

CREATE VIEW `trips_details_upper_layer_view`  AS  select `t_d_ids`.`trip_id` AS `trip_id`,`t_d_ids`.`trip_detail_id` AS `trip_detail_id`,(case when isnull(`t_d_ids`.`decnd_shortage_id`) then (case when isnull(`t_d_ids`.`dest_quantity`) then 0 else `t_d_ids`.`dest_quantity` end) else `t_d_ids`.`decnd_quantity` end) AS `shortage_quantity`,(case when isnull(`t_d_ids`.`decnd_shortage_id`) then (case when isnull(`t_d_ids`.`dest_rate`) then 0 else `t_d_ids`.`dest_rate` end) else `t_d_ids`.`decnd_rate` end) AS `shortage_rate`,(case when isnull(`t_d_ids`.`decnd_shortage_id`) then (case when isnull(`t_d_ids`.`dest_shortage_id`) then 0 else `t_d_ids`.`dest_shortage_id` end) else `t_d_ids`.`decnd_shortage_id` end) AS `shortage_id`,`trips_details`.`product_quantity` AS `dis_qty`,(`trips_details`.`product_quantity` - (case when isnull(`t_d_ids`.`decnd_shortage_id`) then (case when isnull(`t_d_ids`.`dest_quantity`) then 0 else `t_d_ids`.`dest_quantity` end) else `t_d_ids`.`decnd_quantity` end)) AS `rec_qty`,`source_cities`.`cityName` AS `source_city_name`,`trips_details`.`source` AS `source_id`,`destination_cities`.`cityName` AS `destination_city_name`,`trips_details`.`destination` AS `destination_id`,`trips`.`invoice_date` AS `invoice_date`,`trips`.`invoice_number` AS `invoice_number`,`trips`.`company_id` AS `company_id`,`trips`.`customer_id` AS `customer_id`,`trips`.`contractor_id` AS `contractor_id`,`trips_details`.`product` AS `product_id`,`tankers`.`truck_number` AS `tanker_number`,`carriage_contractors`.`name` AS `contractor_name`,`customers`.`name` AS `customer_name`,`companies`.`name` AS `company_name`,`trips_details`.`freight_unit` AS `customer_freight_unit`,`trips_details`.`company_freight_unit` AS `company_freight_unit`,`trips`.`company_commission_2` AS `wht`,`products`.`type` AS `product_type`,`products`.`productName` AS `productName`,`trips`.`entryDate` AS `entryDate`,`trips`.`tanker_id` AS `tanker_id`,`trips_details`.`stn_number` AS `stn_number`,`trips_details`.`bill_id` AS `bill_id`,`trips`.`type` AS `type`,`trip_types`.`trip_type` AS `trip_type`,`trip_types`.`trip_sub_type` AS `trip_sub_type`,`trips`.`company_commission_1` AS `company_commission`,`trips`.`contractor_commission` AS `contractor_commission`,`bills`.`billed_date_time` AS `billed_date_time` from (((((((((((`trips_details_and_dest_decnd_ids` `t_d_ids` left join `trips_details` on((`trips_details`.`id` = `t_d_ids`.`trip_detail_id`))) left join `bills` on((`bills`.`id` = `trips_details`.`bill_id`))) left join `cities` `source_cities` on((`source_cities`.`id` = `trips_details`.`source`))) left join `cities` `destination_cities` on((`destination_cities`.`id` = `trips_details`.`destination`))) left join `trips` on((`trips`.`id` = `t_d_ids`.`trip_id`))) left join `trip_types` on((`trip_types`.`id` = `trips`.`type`))) left join `tankers` on((`tankers`.`id` = `trips`.`tanker_id`))) left join `products` on((`products`.`id` = `trips_details`.`product`))) left join `customers` on((`customers`.`id` = `trips`.`customer_id`))) left join `carriage_contractors` on((`carriage_contractors`.`id` = `trips`.`contractor_id`))) left join `companies` on((`companies`.`id` = `trips`.`company_id`))) ;

-- --------------------------------------------------------

--
-- Structure for view `trips_detail_for_manage_accounts`
--
DROP TABLE IF EXISTS `trips_detail_for_manage_accounts`;

CREATE VIEW `trips_detail_for_manage_accounts`  AS  select `trips_details`.`id` AS `id`,`trips_details`.`trip_id` AS `trip_id`,`trips_details`.`source` AS `source`,`trips_details`.`destination` AS `destination`,`trips_details`.`product` AS `product`,`trips_details`.`product_quantity` AS `product_quantity`,`trips_details`.`qty_at_destination` AS `qty_at_destination`,`trips_details`.`qty_after_decanding` AS `qty_after_decanding`,`trips_details`.`price_unit` AS `price_unit`,`trips_details`.`freight_unit` AS `freight_unit`,`trips_details`.`company_freight_unit` AS `company_freight_unit`,`trips_details`.`stn_number` AS `stn_number`,(case when (`trips_details`.`shortage_voucher_decnd` = '0') then `trips_details`.`shortage_voucher_dest` else `trips_details`.`shortage_voucher_decnd` end) AS `shortage_voucher`,`trips_details`.`bill_id` AS `bill_id` from `trips_details` ;

-- --------------------------------------------------------

--
-- Structure for view `trips_view`
--
DROP TABLE IF EXISTS `trips_view`;

CREATE VIEW `trips_view`  AS  select `tul`.`trip_id` AS `trip_id`,`tul`.`entryDate` AS `entryDate`,`tul`.`tanker_id` AS `tanker_id`,`tul`.`tanker_number` AS `tanker_number`,`tankers`.`capacity` AS `capacity`,`tul`.`customer_name` AS `customer_name`,`tul`.`company_name` AS `company_name`,`tul`.`contractor_name` AS `contractor_name`,`tul`.`customer_id` AS `customer_id`,`tul`.`company_id` AS `company_id`,`tul`.`contractor_id` AS `contractor_id`,`tul`.`source_city_name` AS `source`,`tul`.`destination_city_name` AS `destination`,`tul`.`productName` AS `product`,`tul`.`source_id` AS `source_id`,`tul`.`destination_id` AS `destination_id`,`tul`.`product_id` AS `product_id`,`tul`.`dis_qty` AS `product_quantity`,`tul`.`stn_number` AS `stn_number`,`tul`.`type` AS `trip_type_id`,`trip_types`.`trip_type` AS `trip_type`,`trip_types`.`trip_sub_type` AS `trip_sub_type` from ((`trips_details_upper_layer_view` `tul` left join `trip_types` on((`trip_types`.`id` = `tul`.`type`))) left join `tankers` on((`tankers`.`id` = `tul`.`tanker_id`))) ;

-- --------------------------------------------------------

--
-- Structure for view `trips_with_no_shortage_given_view`
--
DROP TABLE IF EXISTS `trips_with_no_shortage_given_view`;

CREATE VIEW `trips_with_no_shortage_given_view`  AS  select `trips`.`id` AS `trip_id`,`trips`.`entryDate` AS `trip_entry_date`,`trips_details`.`id` AS `detail_id`,`destination_shortages_view`.`shortage_id` AS `dest_shrt_id`,`decanding_shortages_view`.`shortage_id` AS `decnd_shrt_id`,`source_city`.`cityName` AS `source`,`source_city`.`id` AS `source_id`,`destination_city`.`cityName` AS `destination`,`destination_city`.`id` AS `destination_id`,`products`.`productName` AS `product_name`,`products`.`id` AS `product_id`,`tankers`.`truck_number` AS `truck_number`,`tankers`.`id` AS `tanker_id`,`customers`.`name` AS `customer`,`companies`.`name` AS `company`,`carriage_contractors`.`name` AS `contractor` from ((((((((((`trips` left join `trips_details` on((`trips_details`.`trip_id` = `trips`.`id`))) left join `destination_shortages_view` on((`destination_shortages_view`.`trip_detail_id` = `trips_details`.`id`))) left join `decanding_shortages_view` on((`decanding_shortages_view`.`trip_detail_id` = `trips_details`.`id`))) left join `products` on((`products`.`id` = `trips_details`.`product`))) left join `cities` `source_city` on((`source_city`.`id` = `trips_details`.`source`))) left join `cities` `destination_city` on((`destination_city`.`id` = `trips_details`.`destination`))) left join `customers` on((`customers`.`id` = `trips`.`customer_id`))) left join `carriage_contractors` on((`carriage_contractors`.`id` = `trips`.`contractor_id`))) left join `companies` on((`companies`.`id` = `trips`.`company_id`))) left join `tankers` on((`tankers`.`id` = `trips`.`tanker_id`))) where ((`trips`.`active` = 1) and (isnull(`destination_shortages_view`.`shortage_id`) or isnull(`decanding_shortages_view`.`shortage_id`))) ;

-- --------------------------------------------------------

--
-- Structure for view `union_of_automatic_and_mass_vouchers`
--
DROP TABLE IF EXISTS `union_of_automatic_and_mass_vouchers`;

CREATE VIEW `union_of_automatic_and_mass_vouchers`  AS  select `voucher_journal`.`id` AS `voucher_id`,`voucher_journal`.`trip_product_detail_id` AS `trip_detail_id` from `voucher_journal` where ((`voucher_journal`.`auto_generated` = '1') and (`voucher_journal`.`active` = 1)) union select `trip_detail_voucher_relation`.`voucher_id` AS `voucher_id`,`trip_detail_voucher_relation`.`trip_detail_id` AS `trip_detail_id` from `trip_detail_voucher_relation` where (`trip_detail_voucher_relation`.`trip_detail_id` <> 0) ;
