<style>    .white-popup {        position: relative;        background: #FFF;        padding: 20px;        width: auto;        margin: 20px auto;    }    .custom-journal-popup{        position: relative;        background-color: #FFF;        padding: 20px;        width: auto;        max-width: 600px;        margin: 20px auto;    }    table{        font-size: 12px;    }    .search-table2 input, .search-table2 select{        width:100%;    }    .search-table2 input, .search-table2 select{        height: 30px;    }    .search-table2 select{        font-size:12px;    }</style><script>    function show_monthly_results(month, path){        var path = path+month;        window.location.href = path;    }</script><div id="custom-journal-popup" class="custom-journal-popup mfp-hide">    <style>        .custom_journal_inputs select{            height: 30px;            font-size:12px;        }        .custom_journal_inputs input{            height: 25px;            font-size: ;        }    </style>    <script>        function fetch_agents(agent, callback){            var agents_area = document.getElementById("agents_area");            $.get("<?=base_url()."accounts/fetch_agents/"?>"+agent,function(data,status){                agents_area.innerHTML= data;                callback();            });        }        function agent_type_changed()        {            var agent_type_selected_index = document.getElementById("agent_type").selectedIndex;            var agent_type = document.getElementById("agent_type").options[agent_type_selected_index].value;            if(agent_type != ''){                document.getElementById('agents_area').innerHTML = '<span style="font-style: italic; color: gray;">Loading...</span>';                fetch_agents(agent_type,function(){                });            }else{                document.getElementById('agents_area').innerHTML = '';            }        }    </script>    <form action="<?= base_url()."accounts/journal/$agent/$agent_id/"; ?>" method="get">        <input type="hidden" name="accounting_year_from" value="<?= $accounting_year['from'] ?>">        <input type="hidden" name="accounting_year_to" value="<?= $accounting_year['to'] ?>">        <div class="row custom_journal_inputs">            <div class="col-lg-12 text-center" style="color: #269abc">                <h3>Generate Custom Journal</h3><hr>            </div>            <div class="col-lg-12 center-block">                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Voucher ID</label>                    <div class="col-lg-8">                        <input type="number" min="1" placeholder="Voucher Id" value="<?php if(isset($_GET['voucher_id'])){echo $_GET['voucher_id'];} ?>" name="voucher_id">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">From</label>                    <div class="col-lg-8">                        <input size="3" type="date" placeholder="" value="<?php if(isset($_GET['custom_from'])){echo $_GET['custom_from'];} ?>" name="custom_from">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">To</label>                    <div class="col-lg-8">                        <input size="3" type="date" placeholder="" value="<?php if(isset($_GET['custom_to'])){echo $_GET['custom_to'];} ?>" name="custom_to">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Account Title</label>                    <div class="col-lg-8">                        <?php                        $title = (isset($_GET['title']))?$_GET['title']:'';                        ?>                        <select name="title" class="titles_select" style="min-width: 55%">                            <?php                            $title = (isset($_GET['title']))?$_GET['title']:'';                            $selected = ($title == '')?'selected':'';                            echo"<option value='' $selected >any</option>";                            foreach($titles as $t)                            {                                $selected = ($title == $t->id)?"selected":'';                                echo"<option value=".$t->id." $selected>".$t->title."</option>";                            }                            ?>                        </select>                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Show Expenses</label>                    <div class="col-lg-8">                        <select name="expense_type" class="titles_select" style="min-width: 55%">                            <?php                                $selected = (isset($_GET['expense_type']))?$_GET['expense_type']:'';                                echo"<option value=''".(($selected == '')?'selected':'').">--All--</option>";                                echo"<option value='other_expense'".(($selected == 'other_expense')?'selected':'').">Other Expenses</option>";                                echo"<option value='shortage_expense'".(($selected == 'shortage_expense')?'selected':'').">Shortage Expenses</option>";                            ?>                        </select>                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Account Type</label>                    <div class="col-lg-8">                        <?php                        $ac_type = (isset($_GET['ac_type']))?$_GET['ac_type']:'';                        ?>                        <select name="ac_type" style="min-width: 55%">                            <option value="" <?= (($ac_type == 'any')?'selected':''); ?> >any</option>                            <option value="expense" <?= (($ac_type == 'expense')?'selected':''); ?> >Expense</option>                            <option value="payable" <?= (($ac_type == 'payable')?'selected':''); ?> >Payable</option>                            <option value="receivable" <?= (($ac_type == 'receivable')?'selected':''); ?> >Receivable</option>                            <option value="revenue" <?= (($ac_type == 'revenue')?'selected':''); ?> >Revenue</option>                            <option value="bank" <?= (($ac_type == 'bank')?'selected':''); ?>>Bank</option>                            <option value="owner_equity" <?= (($ac_type == 'owner_equity')?'selected':''); ?>>Owner Equity</option>                            <option value="assets" <?= (($ac_type == 'assets')?'selected':''); ?>>Assets</option>                            <option value="retain_earning" <?= (($ac_type == 'retain_earning')?'selected':''); ?>>Retain Earning</option>                            <option value="liability" <?= (($ac_type == 'liability')?'selected':''); ?>>Liability</option>                            <option value="dividend" <?= (($ac_type == 'dividend')?'selected':''); ?>>Dividend</option>                            <option value="" <?= (($ac_type == 'other')?'selected':''); ?> >none</option>                        </select>                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Related Agent</label>                    <div class="col-md-4">                        <select class="" id="agent_type" name="agent_type" onchange="agent_type_changed()" style=" width: 100%; font-size: 12px;">                            <option value="">All</option>                            <option value="other_agents">Other Agent</option>                            <option value="customers">Customer</option>                            <option value="carriage_contractors">Contractor</option>                            <option value="companies">Company</option>                        </select>                    </div>                    <div class="col-md-4" id="agents_area">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Voucher Details</label>                    <div class="col-md-8">                        <textarea style="min-width: 65%" value="<?php if(isset($_GET['voucher_detail'])){echo $_GET['voucher_detail'];} ?>" name="voucher_detail"></textarea>                        <!--<input type="text" placeholder="voucher_details" value="<?php /*if(isset($_GET['voucher_detail'])){echo $_GET['voucher_detail'];} */?>" name="voucher_detail">-->                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Search Summery</label>                    <div class="col-md-8">                        <input type="text" name="summery" value="<?= ((isset($_GET['summery']))?$_GET['summery']:'') ?>">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Tanker Number</label>                    <div class="col-md-8">                        <?php                        $tanker = (isset($_GET['tanker']))?$_GET['tanker']:'';                        ?>                        <select name="tanker" class="tankers_select" style="min-width: 55%">                            <?php                            $tanker = (isset($_GET['tanker']))?$_GET['tanker']:'';                            $selected = ($tanker == '')?'selected':'';                            echo"<option value='' $selected >any</option>";                            foreach($tankers as $t)                            {                                $selected = ($tanker == $t->id)?"selected":'';                                echo"<option value=".$t->id." $selected>".$t->truck_number."</option>";                            }                            ?>                        </select>                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Trip Id</label>                    <div class="col-md-8">                        <input type="number" min="1" placeholder="trip Id" value="<?php if(isset($_GET['trip_id'])){echo $_GET['trip_id'];} ?>" name="trip_id">                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label">Voucher Type</label>                    <div class="col-md-8">                        <?php                            $selected = (isset($_GET['voucher_type']))?$_GET['voucher_type']:'';                        ?>                        <select class="" id="voucher_type" name="voucher_type" style=" width: 60%; font-size: 12px;">                            <option value="" <?= (($selected == '')?'selected':'') ?>>Active</option>                            <option value="1" <?= (($selected == '1')?'':'') ?>>Ignored</option>                            <option value="2" <?= (($selected == '2')?'':'') ?>>All Types</option>                        </select>                    </div>                </div>                <div class="col-sm-12 form-group" style="margin-top: 5px;">                    <label class="col-md-4 control-label"></label>                    <div class="col-lg-4">                        <button style="width: 100%; font-weight: bold; height: 30px;">Generate!</button>                    </div>                </div>                <div id="test_div"></div>            </div>        </div>    </form></div><div id="page-wrapper" style="min-height: 700px;"><div class="container-fluid">    <!--Including the main navbar for accounts section-->    <div class="row">        <?php        include_once(APPPATH."views/accounts/components/main_nav_bar.php");        ?>    </div><div class="row"><div class="col-lg-12"><div class="panel-body"><div class="col-lg-12">    <?php echo validation_errors('<div class="alert alert-danger alert-dismissible" role="alert">                                            <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>                                            <strong>Error! </strong>', '</div>');    ?>    <?php if(is_array(@$someMessage)){ ?>        <div class="alert <?= $someMessage['type']; ?> alert-dismissible" role="alert">            <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>            <?= $someMessage['message']; ?>        </div>    <?php } ?></div><div class="col-lg-12">    <div>        <table style="width: 100%;">            <tr>                <td>                    <?php                    $accounting_years = $this->helper_model->accounting_year_next_previous($accounting_year['from'], $accounting_year['to']);                    ?>                    <a class="btn btn-default" style="font-size: 18px;" href="<?= base_url()."accounts/journal/$agent/$agent_id/?".$accounting_years['previous'] ?>"><i class="fa fa-arrow-circle-left"></i></a>                    <span style="font-weight: bold; font-size: 14px;">                        <?php                        echo $this->carbon->createFromFormat('Y-m-d',$accounting_year['from'])->toFormattedDateString()." / ".$this->carbon->createFromFormat('Y-m-d',$accounting_year['to'])->toFormattedDateString();                        ?>                    </span>                    <a class="btn btn-default" style="font-size: 18px;" href="<?= base_url()."accounts/journal/$agent/$agent_id/?".$accounting_years['next'] ?>"><i class="fa fa-arrow-circle-right"></i></a>                </td>                <td style="text-align: right;">                    <a href="#custom-journal-popup" class="open-custom-journal-popup btn btn-success" style="border-radius: 0px;">Create Custom Journal</a>                </td>            </tr>        </table>        <form name="selection_form" id="selection_form" method="post" action="<?php        if(strpos($this->helper_model->page_url(),'?') == false){            echo $this->helper_model->page_url()."?";        }else{echo $this->helper_model->page_url()."&";}        ?>print">            <table class="table table-bordered table-hover table-striped" style="font-size:12px;">                <thead style="background-color: ; color: ;">                <tr>                    <th style="width: 5%;"><a href="<?php echo $this->helper_model->sorting_info('voucher_journal.id'); ?>" class="sortable-table-heading"><i class="<?= $this->helper_model->sorting_icon('voucher_journal.id', 'numeric'); ?>"> </i> Voucher#</a></th>                    <th style="width: 10%;"><a href="<?php echo $this->helper_model->sorting_info('voucher_journal.voucher_date'); ?>" class="sortable-table-heading"><i class="<?= $this->helper_model->sorting_icon('voucher_journal.voucher_date', 'numeric'); ?>"> </i>Date</a></th>                    <th style="width: 55%">Transaction Detail</th>                    <th style="width: 11%;">Debit</th>                    <th style="width: 11%;">Credit</th>                    <td></td>                </tr>                </thead>                <tbody>                <?php                $total_debit = 0;                $total_credit = 0;                ?>                <?php  foreach($journal as $voucher): ?>                <?php                $voucher_date = $this->carbon->createFromFormat('Y-m-d', $voucher->voucher_date)->toFormattedDateString();                $voucher_debit = 0;                $voucher_credit = 0;                $count = 0;                $entries = sizeof($voucher->entries);                ?>                <?php foreach($voucher->entries as $voucher_entry): ?>                    <?php                        $count++;                    $total_credit += $voucher_entry->credit;                    $voucher_credit+= $voucher_entry->credit;                    $total_debit += $voucher_entry->debit;                    $voucher_debit += $voucher_entry->debit;                    ?>                    <tr style="border-top: <?= ($count == 1)?'5':'0'; ?>px solid lightblue;">                        <?php                            $style = "style='background-color:".(($voucher->ignore == 1)?'lightgray':'').";'";                        ?>                        <?php                        if(isset($mass_vouchers[$voucher->voucher_id])){                            $manage_account = ($mass_vouchers[$voucher->voucher_id][0]->product_type == 'black oil')?'black_oil':'white_oil';                            $voucher_id = "<a target=_blank href='".base_url()."manageaccounts/".$manage_account."?mass_v_id=$voucher->voucher_id"."'>$voucher->voucher_id</a>";                        }else{                            $voucher_id = $voucher->voucher_id;                        }                        ?>                        <?php if($count == 1){echo "<td rowspan=".($entries+1)." $style>".$voucher_id."</td>";} ?>                        <?php if($count == 1){echo "<td rowspan=".($entries+1).">$voucher_date</td>";} ?>                        <td>                            <?= $voucher_entry->title; ?> | <?= $voucher_entry->ac_type; ?>                            <?php if($voucher_entry->related_agent_name != ''): ?>                                | <?= $voucher_entry->related_agent; ?>: <?= $voucher_entry->related_agent_name; ?>                            <?php endif ?>                            <?php if($voucher_entry->description != ''): ?>                                | (<?= $voucher_entry->description; ?>)                            <?php endif ?>                        </td>                        <td><?= (($voucher_entry->dr_cr == 'debit')?round($voucher_entry->debit, 2):''); ?></td>                        <td><?= (($voucher_entry->dr_cr == 'credit')?round($voucher_entry->credit, 2):''); ?></td>                        <?php if($count == 1): ?>                        <td rowspan="<?= ($entries+1) ?>">                            <?php if($this->privilege_model->allow_removing() == true): ?>                                <a href="<?= base_url()."accounts/edit_universal_voucher/".$voucher->voucher_id."/$agent" ?>" class="tanker_expense_voucher_edit"><i class="fa fa-edit"></i></a>                                <a style="margin-left: 5px; color: red;" onclick="return confirm('Warning!\n\nDear user if you delete voucher#<?= $voucher->voucher_id ?> now, you will never be able to get it back.')" href="<?= base_url()."accounts/journal/$agent/$agent_id/?".$this->helper_model->merge_query($_SERVER['QUERY_STRING'], array('delete_voucher'=>$voucher->voucher_id)) ?>"><i class="fa fa-minus-circle"></i></a>                            <?php endif; ?>                        </td>                        <?php endif; ?>                    </tr>                <?php endforeach ?>                <tr style="background-color: <?= ($voucher_debit == $voucher_credit)?'':''; ?>;">                    <td colspan="" style="text-align: center; color: gray; font-style: italic;">                        <div style="width: 60%; min-height: 10px; float: left; border: 0px solid red;">                            <?= $voucher->voucher_details; ?>                        </div>                        <div style="width: 20%; float: left; border: 0px solid red;">                            <div class="text-center" style="color: #555555;">                                <?php                                if($voucher->trip_id > 0){                                    echo " Trip# ".$voucher->trip_id;                                }                                ?>                            </div>                            <div class="text-center" style="color: #555555;">                                <?php                                if($voucher->tanker_number != ''){                                    echo "Tanker# ".$voucher->tanker_number;                                }                                ?>                            </div>                        </div>                        <div class="text-right" style="width: 20%; float: left; border: 0px solid red;">                            <strong style="color: blue;">Total</strong>                        </div>                    </td>                    <?php                    $balance = $voucher_debit-$voucher_credit;                    ?>                    <th style="color: blue; background-color: <?= (($balance != 0)?"rgba(255,0,0,0.1)":"rgba(0,255,0,0.1)") ?>"> <?= $voucher_debit ?> </th>                    <th style="color: blue; background-color: <?= (($balance != 0)?"rgba(255,0,0,0.1)":"rgba(0,255,0,0.1)") ?>"><?= $voucher_credit ?></th>                </tr>                <?php                endforeach;                ?>                </tbody>            </table>        </form>    </div>    <!--//pages-->    <div class="col-lg-12 text-center">        <?php        echo $pages;        ?>    </div></div></div></div></div></div></div><script src="<?= js()."jquery.magnific-popup.min.js"; ?>"></script><script>    $.magnificPopup.instance._onFocusIn = function(e) {        // Do nothing if target element is select2 input        if( $(e.target).hasClass('select2-search__field') ) {            return true;        }        // Else call parent method        $.magnificPopup.proto._onFocusIn.call(this,e);    };    $('.tanker_expense_voucher_edit').magnificPopup({        type: 'ajax',        showCloseBtn:false    });    $('.tanker_expense_voucher').magnificPopup({        type: 'ajax',        showCloseBtn:false    });    $('.open-custom-journal-popup').magnificPopup({        type: 'inline',        showCloseBtn:true,        callbacks: {            open: function() {                $(".tankers_select").select2();                $(".titles_select").select2();            }            // e.t.c.        }    });    $(document).ajaxComplete(function(){        $(".agent_select").select2();    });</script>