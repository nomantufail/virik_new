<?php$file = exporting_file_name("ledger").".xls";header("Content-type: application/vnd.ms-excel");header("Content-Disposition: attachment; filename=$file");?><html><head>    <title>Ledger <?= $account_holder ?></title>    <link href="<?= css()?>bootstrap.min.css" rel="stylesheet"></head><style>    .white-popup {        position: relative;        background: #FFF;        padding: 20px;        width: auto;        max-width: 1000px;        margin: 20px auto;    }    table{        font-size: <?= $font_size ?>;    }    table td, th{        padding: 5px;    }</style><script>    function show_monthly_results(month, path){        var path = path+month;        window.location.href = path;    }</script><div id="page-wrapper" style="min-height: 700px;">    <div class="container-fluid">        <div class="row">            <div class="col-lg-12" style="text-align: center;">                <h3>Ledger</h3>                <h4>                    <?php                    $title = (isset($_GET['ledger_title']))?$_GET['ledger_title']:'';                    $ac_type = (isset($_GET['ledger_ac_type']))?$_GET['ledger_ac_type']:'';                    $related_agent = $_GET['ledger_other_agent_name']."".$_GET['ledger_customer_name']."".$_GET['ledger_contractor_name']."".$_GET['ledger_company_name'];                    ?>                    <?php                    $title = ($title != '*')?$title: '';                    $ac_type = ($ac_type != '*')?$ac_type: '';                    $related_agent = ($related_agent != '****')?$related_agent: '';                    if($title == '' && $ac_type == '' && $related_agent == ''){                        echo "Ledger";                    }                    ?>                    <?= $title." ".$ac_type." ".$related_agent ?>                </h4>                <?php                $from = 'Start';                $end = 'End';                if(isset($_GET['custom_from']) && $_GET['custom_from'] != '')                {                    $from = $this->carbon->createFromFormat('Y-m-d',$_GET['custom_from'])->toFormattedDateString();                }                if(isset($_GET['custom_to']) && $_GET['custom_to'] != '')                {                    $end = $this->carbon->createFromFormat('Y-m-d', $_GET['custom_to'])->toFormattedDateString();                }                ?>                <?php                echo $from;                echo " To ";                echo $end;                ?>            </div>        </div>        <div class="row">            <div class="col-lg-12">                <div class="panel-body">                    <div class="col-lg-12">                        <div>                                <table class="table-bordered table-hover table-striped" style="width: 100%;"  border="1">                                    <?php                                    $starting_balance = $opening_balance;                                    $searched_balance = 0;                                    ?>                                    <thead style="">                                    <tr>                                        <td colspan="7" style="text-align: right;">Opening Balance: <?= (($opening_balance < 0)?"(".($opening_balance*-1).")":$opening_balance) ?></td>                                    </tr>                                    <tr>                                        <?= ((in_array('voucher_id', $columns) == true)?"<th style='text-align:left;'>voucher_id</th>":"") ?>                                        <?= ((in_array('voucher_date', $columns) == true)?"<th style='text-align:left;'>Date</th>":"") ?>                                        <?= ((in_array('account_title', $columns) == true)?"<th style='text-align:left;'>Account Title</th>":"") ?>                                        <?= ((in_array('debit', $columns) == true)?"<th style='text-align:left;'>Debit</th>":"") ?>                                        <?= ((in_array('credit', $columns) == true)?"<th style='text-align:left;'>Credit</th>":"") ?>                                        <?= ((in_array('searched_balance', $columns) == true)?"<th style='text-align:left;'>Searched Balance</th>":"") ?>                                        <?= ((in_array('actual_balance', $columns) == true)?"<th style='text-align:left;'>Actual Balance</th>":"") ?>                                    </tr>                                    </thead>                                    <tbody>                                    <?php                                    $total_balance = 0;                                    $total_debit = 0;                                    $total_credit = 0;                                    ?>                                    <?php  foreach($ledger as $record): ?>                                        <?php $total_debit += $record->debit; ?>                                        <?php $total_credit += $record->credit; ?>                                        <tr style="">                                            <?= ((in_array('voucher_id', $columns) == true)?"<td style='text-align:left;'>".$record->voucher_id." </td>":"") ?>                                            <?= ((in_array('voucher_date', $columns) == true)?"<td style='text-align:left;'>".$this->carbon->createFromFormat('Y-m-d', $record->voucher_date)->toFormattedDateString()." </td>":"") ?>                                            <?php if(in_array('account_title', $columns) == true): ?>                                                <td style='text-align:left;'>                                                    <div style=" min-height: 10px; float: left; border: 0px solid red; color: gray;">                                                        <?php                                                        if(isset($record->title_str)){                                                            echo $record->title_str." ";                                                        }                                                        if(isset($record->ac_type)){                                                            //echo $record->ac_type." ";                                                        }                                                        if(isset($record->related_other_agent_name)){                                                            echo $record->related_other_agent_name."  ";                                                        }                                                        if(isset($record->related_customer_name)){                                                            echo $record->related_customer_name."  ";                                                        }                                                        if(isset($record->related_contractor_name)){                                                            echo $record->related_contractor_name."  ";                                                        }                                                        if(isset($record->related_company_name)){                                                            echo $record->related_company_name."  ";                                                        }                                                        ?>                                                        <?= $record->description; ?>                                                        <?php                                                        if($record->trip_id > 0){                                                            echo "<b> Trip# ".$record->trip_id."</b> ";                                                        }                                                        ?>                                                        <?php                                                        if($record->tanker_number != ''){                                                            echo "<b>Tanker# ".$record->tanker_number."</b>";                                                        }                                                        ?>                                                    </div>                                                </td>                                            <?php endif; ?>                                            <?php if(in_array('debit', $columns) == true): ?>                                                <td style='text-align:left;'><?= (($record->dr_cr == 0)?'':$this->helper_model->money(round($record->debit, 3))); ?></td>                                            <?php endif; ?>                                            <?php if(in_array('credit', $columns) == true): ?>                                                <td style='text-align:left;'><?= (($record->dr_cr == 1)?'':$this->helper_model->money(round($record->credit, 3))); ?></td>                                            <?php endif; ?>                                            <?php if(in_array('searched_balance', $columns) == true): ?>                                                <td style='text-align:left;'>                                                    <?php                                                    $searched_balance = (($record->debit - $record->credit) + $searched_balance);                                                    $searched_balance = round($searched_balance, 3);                                                    ?>                                                    <?= (($searched_balance < 0)?"(".($this->helper_model->money($searched_balance*-1)).")":$this->helper_model->money($searched_balance)) ?>                                                </td>                                            <?php endif; ?>                                            <?php if(in_array('actual_balance', $columns) == true): ?>                                                <td style='text-align:left;'>                                                    <?php                                                    $starting_balance = (($record->debit - $record->credit) + $starting_balance);                                                    $starting_balance = round($starting_balance, 3);                                                    ?>                                                    <?= (($starting_balance < 0)?"(".($this->helper_model->money($starting_balance*-1)).")":$this->helper_model->money($starting_balance)) ?>                                                </td>                                            <?php endif; ?>                                        </tr>                                    <?php endforeach; ?>                                    </tbody>                                    <tfoot>                                    <tr>                                        <?= ((in_array('voucher_id', $columns) == true)?"<th style='text-align:left;'>Totals</th>":"") ?>                                        <?= ((in_array('voucher_date', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('account_title', $columns) == true)?"<th style='text-align:left;'> </th>":"") ?>                                        <?= ((in_array('debit', $columns) == true)?"<th style='text-align:left;'>".$this->helper_model->money(round($total_debit, 3))."</th>":"") ?>                                        <?= ((in_array('credit', $columns) == true)?"<th style='text-align:left;'>".$this->helper_model->money(round($total_credit, 3))."</th>":"") ?>                                        <?= ((in_array('searched_balance', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('actual_balance', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                    </tr>                                    </tfoot>                                </table>                        </div>                    </div>                </div>            </div>        </div>    </div></div>