<?php$file = exporting_file_name("trial_balance").".xls";header("Content-type: application/vnd.ms-excel");header("Content-Disposition: attachment; filename=$file");?><html><head>    <title>Trial Balance</title>    <link href="<?= css()?>bootstrap.min.css" rel="stylesheet"></head><body><style>    table{        font-size: 12px;    }    .multiple_entites{        border-bottom: 1px dashed lightgray;    }</style><div id="page-wrapper" style="min-height: 700px;">    <div class="container-fluid">        <div class="row">            <div class="col-lg-12 text-center" style="font-weight: bold;">                <br>                Trial Balance<br>            </div>            <div>            <table class="table table-bordered table-hover table-striped" style="font-size:12px;"  border="1">            <thead style="">            <tr>                <th style="width: 75%; text-align: left;">Account Title</th>                <th style="width: 11%; text-align: left;">Debit</th>                <th style="width: 11%; text-align: left;">Credit</th>            </tr>            </thead>            <tbody>            <?php            $total_balance = 0;            $other_total_debit = 0;            $other_total_credit = 0;            ?>            <?php            ?>            <?php  foreach($trial_balance['other_entries'] as $record): ?>                <tr style="">                    <td style='text-align:left;'>                        <?php                        $ledger_title = $record->title;                        $ledger_account_title_id = $record->account_title_id;                        $ledger_ac_type = $record->ac_type;                        $related_other_agent_id = $record->related_other_agent;                        $related_other_agent_name = $record->other_agent_name;                        $related_customer_id =  $record->related_customer;                        $related_customer_name = $record->customer_name;                        $related_contractor_id =  $record->related_contractor;                        $related_contractor_name = $record->contractor_name;                        $related_company_id =  $record->related_company;                        $related_company_name = $record->company_name;                        if(!in_array('title', $group_bys)){                            $ledger_title = '*';                            $ledger_account_title_id = '*';                        }                        if(!in_array('ac_type', $group_bys)){                            $ledger_ac_type = '*';                        }                        if(!in_array('related_other_agent', $group_bys)){                            $related_other_agent_id = '*';                            $related_other_agent_name = '*';                            $related_customer_id = '*';                            $related_customer_name = '*';                            $related_contractor_id = '*';                            $related_contractor_name = '*';                            $related_company_id = '*';                            $related_company_name = '*';                        }                        $ledger_query = $this->helper_model->merge_query($_SERVER['QUERY_STRING'],                            array(                                'ledger_title'=>$ledger_title,                                'ledger_account_title_id'=>$ledger_account_title_id,                                'ledger_ac_type'=>$ledger_ac_type,                                'related_other_agent'=>$related_other_agent_id,                                'ledger_other_agent_name'=>$related_other_agent_name.'',                                'related_customer'=>$related_customer_id,                                'ledger_customer_name'=>$related_customer_name.'',                                'related_contractor'=>$related_contractor_id,                                'ledger_contractor_name'=>$related_contractor_name.'',                                'related_company'=>$related_company_id,                                'ledger_company_name'=>$related_company_name.''));                        ?>                            <?php                            if(in_array('title', $group_bys)){                                echo $record->title." ";                            }                            if(in_array('ac_type', $group_bys)){                                echo $record->ac_type." ";                            }                            if(in_array('related_other_agent', $group_bys)){                                echo $record->other_agent_name." ";                            }                            if(in_array('related_customer', $group_bys)){                                echo $record->customer_name." ";                            }                            if(in_array('related_contractor', $group_bys)){                                echo $record->contractor_name." ";                            }                            if(in_array('related_company', $group_bys)){                                echo $record->company_name." ";                            }                            if(sizeof($group_bys) == 0){                                echo "Ledger";                                /*echo $record->title." ";                                echo $record->ac_type." ";                                echo $record->other_agent_name." ";                                echo $record->customer_name." ";                                echo $record->contractor_name." ";                                echo "<span>( ".$record->description." )</span>";*/                            }                            ?>                    </td>                    <?php                    $balance = round(($record->debit - $record->credit), 3);                    $other_total_debit += ($balance > 0)?$balance:0;                    $other_total_credit += ($balance < 0)?($balance*(-1)):0;                    ?>                    <td style='text-align:left;'><?= (($balance > 0)?$this->helper_model->money($balance):''); ?><?= (($balance == 0)?0:''); ?></td>                    <td style='text-align:left;'><?= (($balance < 0)?$this->helper_model->money(($balance * -1)):''); ?><?= (($balance == 0)?0:''); ?></td>                </tr>            <?php endforeach; ?>            <tr>                <?php                $balance = $other_total_credit - $other_total_debit;                ?>                <th style="text-align: right;">Totals:</th>                <th style=""><?= $this->helper_model->money(round($other_total_debit, 3)) ?></th>                <th style=""><?= $this->helper_model->money(round($other_total_credit, 3)) ?></th>            </tr>            <tr>                <th colspan="1" style="text-align: center">Bank Accounts</th>                <th colspan="2"></th>            </tr>            <!--/*            *showing bank accounts area            */-->            <?php            //fetching the bank a/c id            $this->db->select('id');            $raw_titile = $this->db->get_where('account_titles',array(                'title'=>'Bank A/c',            ))->result();            $bank_ac_title_id = $raw_titile[0]->id;            ?>            <?php            $bank_ac_total_debit = 0;            $bank_ac_total_credit = 0;            ?>            <?php  foreach($trial_balance['bank_ac_entries'] as $record): ?>                <tr style="">                    <td style='text-align:left;'>                        <?php                        $ledger_title = 'Bank A/c';                        $ledger_account_title_id = $bank_ac_title_id;                        $ledger_ac_type = $record->ac_type;                        $related_other_agent_id = $record->related_other_agent;                        $related_other_agent_name = $record->other_agent_name;                        $related_customer_id =  $record->related_customer;                        $related_customer_name = $record->customer_name;                        $related_contractor_id =  $record->related_contractor;                        $related_contractor_name = $record->contractor_name;                        $related_company_id =  $record->related_company;                        $related_company_name = $record->company_name;                        /*if(!in_array('title', $group_bys)){                            $ledger_title = '*';                            $ledger_account_title_id = '*';                        }*/                        if(!in_array('ac_type', $group_bys)){                            $ledger_ac_type = '*';                        }                        if(!in_array('related_other_agent', $group_bys)){                            $related_other_agent_id = '*';                            $related_other_agent_name = '*';                            $related_customer_id = '*';                            $related_customer_name = '*';                            $related_contractor_id = '*';                            $related_contractor_name = '*';                            $related_company_id = '*';                            $related_company_name = '*';                        }                        $ledger_query = $this->helper_model->merge_query($_SERVER['QUERY_STRING'],                            array(                                'ledger_title'=>$ledger_title,                                'ledger_account_title_id'=>$ledger_account_title_id,                                'ledger_ac_type'=>$ledger_ac_type,                                'related_other_agent'=>$related_other_agent_id,                                'ledger_other_agent_name'=>$related_other_agent_name.'',                                'related_customer'=>$related_customer_id,                                'ledger_customer_name'=>$related_customer_name.'',                                'related_contractor'=>$related_contractor_id,                                'ledger_contractor_name'=>$related_contractor_name.'',                                'related_company'=>$related_company_id,                                'ledger_company_name'=>$related_company_name.''));                        ?>                            <?php                            if(in_array('title', $group_bys)){                                echo $record->title." ";                            }                            if(in_array('ac_type', $group_bys)){                                echo $record->ac_type." ";                            }                            if(in_array('related_other_agent', $group_bys)){                                echo $record->other_agent_name." ";                            }                            if(in_array('related_customer', $group_bys)){                                echo $record->customer_name." ";                            }                            if(in_array('related_contractor', $group_bys)){                                echo $record->contractor_name." ";                            }                            if(in_array('related_company', $group_bys)){                                echo $record->company_name." ";                            }                            if(sizeof($group_bys) == 0){                                echo "Ledger";                                /*echo $record->title." ";                                echo $record->ac_type." ";                                echo $record->other_agent_name." ";                                echo $record->customer_name." ";                                echo $record->contractor_name." ";                                echo "<span>( ".$record->description." )</span>";*/                            }                            ?>                    </td>                    <?php                    $balance = round(($record->debit - $record->credit), 3);                    $bank_ac_total_debit += ($balance > 0)?$balance:0;                    $bank_ac_total_credit += ($balance < 0)?($balance*(-1)):0;                    ?>                    <td style='text-align:left;'><?= (($balance > 0)?$this->helper_model->money($balance):''); ?><?= (($balance == 0)?0:''); ?></td>                    <td style='text-align:left;'><?= (($balance < 0)?$this->helper_model->money(($balance * -1)):''); ?><?= (($balance == 0)?0:''); ?></td>                </tr>            <?php endforeach; ?>            <tr>                <th style="text-align: right;">Totals:</th>                <th style=""><?= $this->helper_model->money(round($bank_ac_total_debit, 3)) ?></th>                <th style=""><?= $this->helper_model->money(round($bank_ac_total_credit, 3)) ?></th>            </tr>            <!--/*           *showing cash accounts area           */-->            </tbody>            <tfoot>            <tr style="border-top: 2px solid darkgrey;">                <?php                $grand_total_credit = $other_total_credit + $bank_ac_total_credit;                $grand_total_debit = $other_total_debit + $bank_ac_total_debit;                $balance = $grand_total_credit - $grand_total_debit;                ?>                <th style="text-align: right; color: blue;">Grand Totals:</th>                <th style="color: blue; background-color: <?= (($balance != 0)?"rgba(255,0,0,0.1)":"rgba(0,255,0,0.1)") ?>"><?= $this->helper_model->money(round($grand_total_debit, 3)) ?></th>                <th style="color: blue; background-color: <?= (($balance != 0)?"rgba(255,0,0,0.1)":"rgba(0,255,0,0.1)") ?>"><?= $this->helper_model->money(round($grand_total_credit, 3)) ?></th>            </tr>            </tfoot>            </table>            </div>        </div>    </div></div><script src="<?= js()?>sorttable.js"></script></body></html>