<?php$file = exporting_file_name("Fuel Report").".xls";header("Content-type: application/vnd.ms-excel");header("Content-Disposition: attachment; filename=$file");?><html><head>    <title>Fuel Report</title>    <link href="<?= css()?>bootstrap.min.css" rel="stylesheet"></head><body><style>    .trips-table{        <?php            $font_size = $this->settings_model->system_settings('printing font size');        ?>        font-size: <?= $font_size ?>;    }    table th, td{        padding: 5px;    }    .multiple_entites{        border-bottom: 1px dashed lightgray;    }</style><div id="page-wrapper" style="min-height: 700px;">    <div class="container-fluid">        <div class="row">            <div class="col-lg-12">                <section class="col-md-6">                    <h3 class="page-header">                        Fuel Report <small></small>                    </h3>                </section>            </div>        </div>        <div class="row">            <div class="col-lg-12">                <div class="panel-body">                    <div id="myTabContent" class="tab-content">                        <div class="tab-pane fade in active" id="trips">                            <div class="table-responsive" style="overflow-x: auto;">                                <table>                                    <tr>                                        <td colspan="9" style="font-weight: bold;"></td>                                    </tr>                                </table>                                <table class="table-bordered table-hover table-striped trips-table sortable" border="1">                                    <thead style="border-top: 4px solid lightgray;">                                    <tr>                                        <?= ((in_array('id', $columns) == true)?"<td style='text-align:left;'>ID </td>":"") ?>                                        <?= ((in_array('type', $columns) == true)?"<td style='text-align:left;'>Type </td>":"") ?>                                        <?= ((in_array('trip_date', $columns) == true)?"<td style='text-align:left;'> Date </td>":"") ?>                                        <?= ((in_array('tanker', $columns) == true)?"<td style='text-align:left;'>Tanker </td>":"") ?>                                        <?= ((in_array('capacity', $columns) == true)?"<td style='text-align:left;'>Capacity </td>":"") ?>                                        <?= ((in_array('contractor', $columns) == true)?"<td style='text-align:left;'> Contractor </td>":"") ?>                                        <?= ((in_array('customer', $columns) == true)?"<td style='text-align:left;'>Customer</td>":"") ?>                                        <?= ((in_array('company', $columns) == true)?"<td style='text-align:left;'>Company</td>":"") ?>                                        <?= ((in_array('source', $columns) == true)?"<td style='text-align:left;'>Source </td>":"") ?>                                        <?= ((in_array('destination', $columns) == true)?"<td style='text-align:left;'>Destination </td>":"") ?>                                        <?= ((in_array('product', $columns) == true)?"<td style='text-align:left;'>Product </td>":"") ?>                                        <?= ((in_array('product_quantity', $columns) == true)?"<td style='text-align:left;'>Product Quantity </td>":"") ?>                                        <?= ((in_array('stn', $columns) == true)?"<td style='text-align:left;'>STN-Number</td>":"") ?>                                        <?= ((in_array('shortage_voucher_dest', $columns) == true)?"<td style='text-align:left;'>Shortage Voucher(dest)</td>":"") ?>                                        <?= ((in_array('shortage_voucher_decnd', $columns) == true)?"<td style='text-align:left;'>Shortage Voucher(decnd)</td>":"") ?>                                        <?= "<td style='text-align:left;'>Meter Reading (end - start)</td>" ?>                                        <?= "<td style='text-align:left;'>Fuel Consumed</td>" ?>                                        <?= "<td style='text-align:left;'>Millage</td>" ?>                                    </tr>                                    </thead>                                    <tbody>                                    <?php                                    $total_product_quantity = 0;                                    $total_capacity = 0;                                    $total_net_meter = 0;                                    $total_fuel_consumed = 0;                                    $total_avg_fuel_consumed = 0;                                    ?>                                    <?php $parent_count = 0; ?>                                    <?php  foreach($trips as $trip): ?>                                        <?php                                        $count = 0;                                        $num_trip_product_details = sizeof($trip->trip_related_details);                                        ?>                                        <?php foreach($trip->trip_related_details as $detail): ?>                                            <?php                                            $count++;                                            $parent_count++;                                            ?>                                            <tr style="border-top: <?= ($count == 1)?'3':'0'; ?>px solid lightblue;">                                                <!--first column-->                                                <?php if(in_array('id', $columns) == true): ?>                                                    <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">".$trip->trip_id."</td>";} ?>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('type', $columns) == true): ?>                                                    <?php                                                    $trip_type = 'undefined';                                                    switch($trip->type)                                                    {                                                        case 1:                                                            $trip_type = 'Self / Mail';                                                            break;                                                        case 2:                                                            $trip_type = 'General';                                                            break;                                                        case 3:                                                            $trip_type = 'Local Company';                                                            break;                                                        case 4:                                                            $trip_type = 'Local Self';                                                            break;                                                        case 5:                                                            $trip_type = 'General Local';                                                            break;                                                        case 6:                                                            $trip_type = 'Secondary Local';                                                            break;                                                        default:                                                            $trip_type = 'undefined';                                                            break;                                                    }                                                    ?>                                                    <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">".($trip_type)."</td>";} ?>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('trip_date', $columns) == true): ?>                                                    <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">".Carbon::createFromFormat('Y-m-d',$trip->dates->entry_date)->toFormattedDateString()."</td>";} ?>                                                <?php endif; ?>                                                <?php                                                    $total_capacity += $trip->tanker->capacity;                                                ?>                                                <!--first column-->                                                <?php if(in_array('tanker', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $trip->tanker->tanker_number; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('capacity', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $trip->tanker->capacity; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('contractor', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $trip->contractor->name; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('customer', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $trip->customer->name; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('company', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $trip->company->name; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('source', $columns) == true): ?>                                                    <td style="font-size: 11px;"><?= $detail->source->name; ?></td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('destination', $columns) == true): ?>                                                    <td style="font-size: 11px;"><?= $detail->destination->name; ?></td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('product', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $detail->product->name; ?> </td>                                                <?php endif; ?>                                                <?php                                                    $total_product_quantity += $detail->product_quantity;                                                ?>                                                <!--first column-->                                                <?php if(in_array('product_quantity', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $detail->product_quantity; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('stn', $columns) == true): ?>                                                    <td style='text-align:left;'> <?= $detail->stn_number; ?> </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('shortage_voucher_dest', $columns) == true): ?>                                                    <td style='text-align:left;'>                                                        <?php if($detail->shortage_voucher_dest != 0): ?>                                                            <?= $detail->shortage_voucher_dest; ?>                                                        <?php endif; ?>                                                    </td>                                                <?php endif; ?>                                                <!--first column-->                                                <?php if(in_array('shortage_voucher_decnd', $columns) == true): ?>                                                    <td style='text-align:left;'>                                                        <?php if($detail->shortage_voucher_decnd != 0): ?>                                                            <?= $detail->shortage_voucher_decnd; ?>                                                        <?php endif; ?>                                                    </td>                                                <?php endif; ?>                                                <?php                                                    $start_meter = $trip->start_meter;                                                    $end_meter = $trip->end_meter;                                                    $fuel_consumed = $trip->fuel_consumed;                                                    $net_meter = $end_meter - $start_meter;                                                    if($fuel_consumed == 0)                                                    {                                                        $avg_fuel_consumed = 0;                                                    }else{                                                        $avg_fuel_consumed = round($net_meter / $fuel_consumed, 3);                                                    }                                                    $total_net_meter += $net_meter;                                                    $total_fuel_consumed += $fuel_consumed;                                                    $total_avg_fuel_consumed += $avg_fuel_consumed;                                                ?>                                                <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">"."(".$end_meter." - ".$start_meter.") = ".$net_meter."</td>";} ?>                                                <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">".$fuel_consumed."</td>";} ?>                                                <?php if($count == 1){echo "<td rowspan=".($num_trip_product_details).">".$avg_fuel_consumed."</td>";} ?>                                            </tr>                                        <?php endforeach ?>                                    <?php endforeach; ?>                                    </tbody>                                    <tfoot>                                    <tr>                                        <?= ((in_array('id', $columns) == true)?"<th style='text-align:left;'>Totals</th>":"") ?>                                        <?= ((in_array('type', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('trip_date', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('tanker', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('capacity', $columns) == true)?"<th style='text-align:left;'>".$this->helper_model->money($total_capacity)."</th>":"") ?>                                        <?= ((in_array('contractor', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('customer', $columns) == true)?"<th style='width: 5%;'></th>":"") ?>                                        <?= ((in_array('company', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('source', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('destination', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('product', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('product_quantity', $columns) == true)?"<th style='text-align:left;'>".$this->helper_model->money($total_product_quantity)."</th>":"") ?>                                        <?= ((in_array('company_freight_unit', $columns) == true)?"<th style='width: 5%;'></th>":"") ?>                                        <?= ((in_array('stn', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('shortage_voucher_dest', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <?= ((in_array('shortage_voucher_decnd', $columns) == true)?"<th style='text-align:left;'></th>":"") ?>                                        <th style='text-align:left;'><?= $this->helper_model->money($total_net_meter) ?></th>                                        <th style='text-align:left;'><?= $this->helper_model->money($total_fuel_consumed) ?></th>                                        <th style='text-align:left;'>Total:<?= $this->helper_model->money($total_avg_fuel_consumed) ?><br>Avg: <?= round($total_avg_fuel_consumed/sizeof($trips), 3) ?></th>                                    </tr>                                    </tfoot>                                </table>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div></div><script src="<?= js()?>sorttable.js"></script></body></html>