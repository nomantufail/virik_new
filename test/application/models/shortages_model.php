<?phpclass shortages_model extends CI_Model {    public function __construct(){        parent::__construct();    }    public function get_trips()    {        include_once(APPPATH."models/helperClasses/TripWithNoShortageGiven.php");        $this->db->select('*');        $this->helper_model->search("Add_Shortages_Search_Form","shortages");        $this->db->limit(150);        $result = $this->db->get('trips_with_no_shortage_given_view')->result();        $trips_with_no_shortage_given = [];        foreach($result as $trip)        {            $trips_with_no_shortage_given[] = new TripWithNoShortageGiven($trip);        }        return $trips_with_no_shortage_given;    }    public function destination()    {        $sorting_info = Sort::columns('shortages');        $this->db->select("*");        $this->helper_model->search("Shortages_Search_Form","shortages");        $this->helper_model->sort($sorting_info);        return $this->db->get('destination_shortages_view')->result();    }    public function decanding()    {        $sorting_info = Sort::columns('shortages');        $this->db->select("*");        $this->helper_model->search("Shortages_Search_Form","shortages");        $this->helper_model->sort($sorting_info);        return $this->db->get('decanding_shortages_view')->result();    }    public function commit()    {        include_once(APPPATH."models/helperClasses/CommitShortages.php");        $commit_manager = new CommitShortages();        return $commit_manager->letTheGameBegin();    }    public function find($id)    {        $this->db->select('*');        $this->db->where('id', $id);        $result = $this->db->get('shortages')->result();        if(sizeof($result) > 0)            return $result[0];        return null;    }    public function update_shortage()    {        $data = [            'id' => $_POST['shortage_id'],            'date'=>$_POST['date'],            'quantity' => $_POST['quantity'],            'rate' => $_POST['rate']        ];        $this->db->where('id',$_POST['shortage_id']);        return $this->db->update('shortages',$data);    }    public function delete_shortage($shortage_id)    {        $this->db->select('shortages.trip_detail_id, trips_details.trip_id');        $this->db->join('trips_details','trips_details.id = shortages.trip_detail_id','left');        $this->db->where('shortages.id',$shortage_id);        $result = $this->db->get('shortages')->result();        $trip_id = $result[0]->trip_id;        $trip_detail_id = $result[0]->trip_detail_id;        $this->db->trans_start();        //deleting shortage        $this->db->where('id',$shortage_id);        $this->db->delete('shortages');        //deleting shortage voucher        $this->db->where('voucher_journal.shortage_id',$shortage_id);        $this->db->delete('voucher_journal');        //deleting deduction voucher        $this->db->where('voucher_journal.trip_product_detail_id',$trip_detail_id);        $where = "(voucher_journal.voucher_type = 'dest_shortage_deduction' OR voucher_journal.voucher_type = 'decnd_shrotage_dedcution' )";        $this->db->where($where);        $this->db->delete('voucher_journal');        return $this->db->trans_complete();    }}