<div class="white-popup" style="background-color: #ffffff;"><script>    function display_row(){        var pannel_count = document.getElementById("pannel_count");        var row_id = "row_"+pannel_count.value;        document.getElementById(row_id).style.display='';        document.getElementById(row_id).style.width='100%';        pannel_count.value = parseInt(pannel_count.value)+1;        //we think that when a new row is added we should re_populate the form...        //i_think_route_changed(0,pannel_count.value-1);    }    function hide_row(){        var pannel_count = document.getElementById("pannel_count");        var decrease_count = parseInt(pannel_count.value)-1;        var row_id = "row_"+decrease_count;        if(pannel_count.value > 3){            document.getElementById(row_id).style.display='none';            pannel_count.value = parseInt(pannel_count.value)-1;        }    }    function fetch_tankers(trip_id, customer_id, callback){        var tankers_area = document.getElementById("voucher_tankers_area");        tankers_area.innerHTML = ".....";        $.get("<?=base_url()."accounts/fetch_tankers/"?>"+trip_id+"/"+customer_id,function(data,status){            tankers_area.innerHTML= data;            callback();        });    }    function fetch_customers(trip_id, callback){        var customers_area = document.getElementById("voucher_customers_area");        customers_area.innerHTML = ".....";        var requested_customer = document.getElementById("requested_customer").value;        requested_customer = (requested_customer == '')?'none':requested_customer;        $.get("<?=base_url()."accounts/fetch_customers/"?>"+trip_id+"/"+requested_customer ,function(data,status){            customers_area.innerHTML= data;            callback();        });    }    function i_think_trip_changed()    {        var tankers_area = document.getElementById("voucher_tankers_area");        tankers_area.innerHTML = ".....";        var customers_area = document.getElementById("voucher_customers_area");        customers_area.innerHTML = ".....";        trip_id = document.getElementById('trip_id').value;        if(trip_id == '' || trip_id < 1){            trip_id = "null";            fetch_customers(trip_id, function(){                i_think_customer_changed();            })        }else{            trip_id = parseInt(trip_id);            fetch_tankers(trip_id,'null', function() {                fetch_customers(trip_id, function(){                })            });        }    }    function i_think_customer_changed()    {        var customers_selected_index = document.getElementById("customers").selectedIndex;        var customer_id = document.getElementById("customers").options[customers_selected_index].value;        fetch_tankers('null', customer_id, function(){            //nothing here..        });    }    function amount_changed()    {        var balance_target = document.getElementById('voucher_balance');        var pannel_count = document.getElementById("pannel_count");        var debit_amount = 0;        var credit_amount = 0;        for(var count = 0; count<(pannel_count.value-1); count++){            var amount = document.getElementsByClassName("amount")[count].value;            amount = (amount == '')?0:parseFloat(amount);            var payment_type_selected_index = document.getElementsByClassName("payment_type")[count].selectedIndex;            var payment_type = document.getElementsByClassName("payment_type")[count].options[payment_type_selected_index].value;            if(payment_type == '1'){                debit_amount = debit_amount+amount;            }else{                credit_amount += amount;            }        }        var balance = debit_amount - credit_amount;        balance_target.innerHTML =balance;    }    //here is the stuff we do when document is ready...    $( document ).ready(function() {        i_think_trip_changed();        amount_changed();    });    function validate_voucher_form()    {        if(parseInt(document.getElementById("voucher_balance").innerHTML) != 0){            document.getElementById("balance_area").className+=' some_problem';            alert("Balance in not zero...\n please recheck your entries.");            return false;        }        return true;    }</script><style>    .voucher_title{        font-size: 18px;        font-weight: bold;        color: #0088cc;    }    .voucher_date{        font-weight: bold;        font-size: 14px;    }    .voucher_form input{        height: 25px;    }    .un_balanced{        color: red;    }    .some_problem{        border: 2px dashed red;    }</style><div class="row">    <form method="post" class="voucher_form" onsubmit="return validate_voucher_form()">        <div class="col-lg-12">            <div class="col-sm-12" style="border: 0px solid red;">                <div class="voucher_title col-sm-6">Tanker Expense Voucher</div>                <div class="voucher_date col-sm-6 text-right"><input type="date" name="voucher_date" required="required"></div>            </div>            <div class="col-lg-12" style="overflow-x: auto; border: 0px solid red;">                <table class="table table-bordered"  style="font-size: 12px; overflow: auto;">                    <tr>                        <td>                            <input type="hidden" value="<?= $form_id ?>" name="form_id">                            <div>                                <div class="col-sm-4"><span style="font-size: 14px; font-weight: bold;">Tanker# </span>                                    <span id="voucher_tankers_area">...</span>                                </div>                                <div class="col-sm-3"><span style="font-size: 14px; font-weight: bold;">Trip ID: </span><span><input type="number" name="trip_id" onkeyup="i_think_trip_changed()" id="trip_id" min="1" max="<?= $max_trip_id ?>"></span></div>                                <div class="col-sm-5"><span style="font-size: 14px; font-weight: bold;"><input type="hidden" name="requested_customer" id="requested_customer" value="<?php if(isset($_GET['customer'])){echo $_GET['customer'];} ?>">Customer: </span><span id="voucher_customers_area">...</span></div>                            </div>                        </td>                    </tr>                    <tr>                        <td>                            <div class="panel-body">                                <table style="font-size: 12px;" class="product_details_table table">                                    <thead>                                    <tr id="">                                        <th>Tr_Type</th>                                        <th>Tr_Title</th>                                        <th>Description</th>                                        <th>Agent</th>                                        <th>Amount</th>                                        <th>Dr/Cr</th>                                    </tr>                                    </thead>                                    <tbody>                                    <?php                                    for($row_counter = 1; $row_counter<9; $row_counter++){                                        ?>                                        <tr id="row_<?= $row_counter ?>" style="display: <?= ($row_counter > 2)?"none":"visible"; ?>; width: 100%;">                                            <td>                                                <select name="<?= "tr_type_".$row_counter; ?>">                                                    <option value="expense">Expense</option>                                                    <option value="payable">Payable</option>                                                    <option value="receivable">receivable</option>                                                    <option value="revenue">revenue</option>                                                    <option value="bank">Bank</option>                                                    <option value="owner_equity">Owner Equity</option>                                                    <option value="assets">Assets</option>                                                    <option value="retain_earning">Retain Earning</option>                                                    <option value="liability">Liability</option>                                                    <option value="dividend">Dividend</option>                                                    <option value="">none</option>                                                </select>                                            </td>                                            <td>                                                <select style="width: 100px;" name="<?= "tr_title_".$row_counter; ?>">                                                    <?php                                                    foreach($titles as $title)                                                    {                                                        $selected = '';                                                        if(isset($_GET['title'])){                                                            $selected = ($_GET['title'] == $title->id)?"selected":'';                                                        }                                                        echo"<option value=".$title->id." $selected>".$title->title."</option>";                                                    }                                                    echo"<option value=''>none</option>";                                                    ?>                                                </select>                                            </td>                                            <td>                                                <input type="text" placeholder="other info..." name="<?= "description_".$row_counter; ?>">                                            </td>                                            <td>                                                <select class="agent_type" onchange="agent_type_changed()" name="<?= "agent_type_".$row_counter; ?>">                                                    <option value="other_agents">Other Agent</option>                                                </select>                                                <select name="<?= "agent_".$row_counter; ?>">                                                    <?php                                                        foreach($other_agents as $agent)                                                        {                                                            $selected = '';                                                            if(isset($_GET['other_agent'])){                                                                $selected = ($_GET['other_agent'] == $agent->id)?"selected":'';                                                            }                                                            echo"<option value=".$agent->id." $selected>".$agent->name."</option>";                                                        }                                                    echo"<option value=''>none</option>";                                                    ?>                                                </select>                                            </td>                                            <td><input onkeyup="amount_changed()" onchange="amount_changed()" type="number" step="any" class="amount" name="<?= "amount_".$row_counter; ?>" placeholder="amount.."></td>                                            <td>                                                <select class="payment_type" onchange="amount_changed()" name="<?= "payment_type_".$row_counter; ?>">                                                    <option value="1">Debit</option>                                                    <option value="0">Credit</option>                                                </select>                                            </td>                                        </tr>                                    <?php                                    }                                    ?>                                    </tbody>                                    <tfoot>                                    <tr style="border-bottom: 0px; display: table-row; font-size: 13px;">                                        <td><a style="text-decoration: none; cursor: pointer;" onclick="display_row()"><i class="fa fa-plus-circle"></i> Add Entry</a></td><td><a   style="float: right; cursor: pointer; color: red; text-decoration: none;" onclick="hide_row()"><i class="fa fa-minus-circle"></i> remove</a><input size="2" value="3" type="hidden" id="pannel_count" name="pannel_count"></td>                                    </tr>                                    </tfoot>                                </table>                            </div>                        </td>                    </tr>                    <tr>                        <td>                            <div class="col-sm-2 text-center" id="balance_area">                                <strong>Balance: </strong><span class="balance" id="voucher_balance"></span>                            </div>                            <div class="col-sm-8">                                <input type="text" class="form-control" name="voucher_details" placeholder="your voucher details... if any" style="width: 100%;">                            </div>                            <div class="col-sm-2 text-center">                                <input type="submit" name="save_voucher" value="Save" style="background-color: #31708f; color: #ffffff;">                            </div>                        </td>                    </tr>                </table>            </div>        </div>    </form></div></div>