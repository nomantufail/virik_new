<?php$file = exporting_file_name("income_statement").".xls";header("Content-type: application/vnd.ms-excel");header("Content-Disposition: attachment; filename=$file");?><html><head>    <title>Income Statement <?= $account_holder ?></title>    <link href="<?= css()?>bootstrap.min.css" rel="stylesheet"></head><body><style>    table{        font-size: 12px;    }    .multiple_entites{        border-bottom: 1px dashed lightgray;    }</style><div id="page-wrapper" style="min-height: 700px;">    <div class="container-fluid">        <div class="row">            <div class="col-lg-12 text-center" style="font-weight: bold;">                <?= $account_holder."" ?><br>                Income Statement<br>                <?= $this->carbon->createFromFormat('Y-m-d',$accounting_year['from'])->toFormattedDateString()." / ".$this->carbon->createFromFormat('Y-m-d',$accounting_year['to'])->toFormattedDateString(); ?>            </div>            <?php if(in_array('ac_type', $group_bys)): ?>                <div class="col-lg-12">                <div>                <form name="selection_form" id="selection_form" method="post" action="<?php                if(strpos($this->helper_model->page_url(),'?') == false){                    echo $this->helper_model->page_url()."?";                }else{echo $this->helper_model->page_url()."&";}                ?>print">                <table class="table table-bordered table-hover table-striped" style="font-size:12px;" border="1">                <thead style="">                <tr>                    <th style="width: 75%">Transaction Details</th>                    <th style="width: 11%;">Debit</th>                    <th style="width: 11%;">Credit</th>                </tr>                </thead>                <tbody>                <tr>                    <td colspan="3" style="background-color: orangered; color: white; text-align: center; font-size: 18px;">                        <b>Expenses</b>                    </td>                </tr>                <?php                $total_expense = 0;                $count = 0;                ?>                <?php  foreach($expenses as $expense): ?>                    <?php                    $count++;                    $remaining = round(($expense->debit - $expense->credit), 3);                    $total_expense += $remaining;                    ?>                    <tr style="">                        <td>                            <?php                            $ledger_title = $expense->title;                            $ledger_account_title_id = $expense->account_title_id;                            $ledger_ac_type = $expense->ac_type;                            $related_other_agent_id = $expense->related_other_agent;                            $related_other_agent_name = $expense->other_agent_name;                            $related_customer_id =  $expense->related_customer;                            $related_customer_name = $expense->customer_name;                            $related_contractor_id =  $expense->related_contractor;                            $related_contractor_name = $expense->contractor_name;                            $related_company_id =  $expense->related_company;                            $related_company_name = $expense->company_name;                            if(!in_array('title', $group_bys)){                                $ledger_title = '*';                                $ledger_account_title_id = '*';                            }                            if(!in_array('ac_type', $group_bys)){                                $ledger_ac_type = '*';                            }                            if(!in_array('related_other_agent', $group_bys)){                                $related_other_agent_id = '*';                                $related_other_agent_name = '*';                                $related_customer_id = '*';                                $related_customer_name = '*';                                $related_contractor_id = '*';                                $related_contractor_name = '*';                                $related_company_id = '*';                                $related_company_name = '*';                            }                            $ledger_query = $this->helper_model->merge_query($_SERVER['QUERY_STRING'],                                array(                                    'ledger_title'=>$ledger_title,                                    'ledger_account_title_id'=>$ledger_account_title_id,                                    'ledger_ac_type'=>$ledger_ac_type,                                    'related_other_agent'=>$related_other_agent_id,                                    'ledger_other_agent_name'=>$related_other_agent_name.'',                                    'related_customer'=>$related_customer_id,                                    'ledger_customer_name'=>$related_customer_name.'',                                    'related_contractor'=>$related_contractor_id,                                    'ledger_contractor_name'=>$related_contractor_name.'',                                    'related_company'=>$related_company_id,                                    'ledger_company_name'=>$related_company_name.''));                            ?>                                <?php                                if(in_array('title', $group_bys)){                                    echo $expense->title." ";                                }                                if(in_array('ac_type', $group_bys)){                                    echo $expense->ac_type." ";                                }                                if(in_array('related_other_agent', $group_bys)){                                    echo $expense->other_agent_name." ";                                }                                if(in_array('related_customer', $group_bys)){                                    echo $expense->customer_name." ";                                }                                if(in_array('related_contractor', $group_bys)){                                    echo $expense->contractor_name." ";                                }                                if(in_array('related_company', $group_bys)){                                    echo $expense->company_name." ";                                }                                /*echo $expense->title." | ";                                echo $expense->ac_type." | ";                                echo $expense->other_agent_name." ";                                echo $expense->customer_name."";                                echo $expense->contractor_name."";*/                                ?>                        </td>                        <td><?= (($remaining > 0)?$this->helper_model->money($remaining):''); ?><?= (($remaining == 0)?0:''); ?></td>                        <td><?= (($remaining < 0)?$this->helper_model->money(($remaining * -1)):''); ?><?= (($remaining == 0)?0:''); ?></td>                    </tr>                <?php endforeach; ?>                <tr style="">                    <th style="text-align: right;">                        Total Expenses:                    </th>                    <th>                        <?php $total_expense = round($total_expense, 3);?>                        <?= (($total_expense >= 0)?$this->helper_model->money($total_expense):"(".$this->helper_model->money($total_expense*(-1)).")") ?>                    </th>                    <td></td>                </tr>                <tr>                    <td colspan="3" style="background-color: green; color: white; text-align: center; font-size: 18px;">                        <b>Revenues</b>                    </td>                </tr>                <?php                $total_revenue = 0;                ?>                <?php  foreach($revenues as $revenue): ?>                    <?php                    //$total_revenue += $revenue->credit - $revenue->debit;                    $remaining = $revenue->debit - $revenue->credit;                    $total_revenue += $remaining;                    ?>                    <tr style="border-top: 0px solid lightgreen;">                        <td>                            <?php                            $ledger_title = $revenue->title;                            $ledger_account_title_id = $revenue->account_title_id;                            $ledger_ac_type = $revenue->ac_type;                            $related_other_agent_id = $revenue->related_other_agent;                            $related_other_agent_name = $revenue->other_agent_name;                            $related_customer_id =  $revenue->related_customer;                            $related_customer_name = $revenue->customer_name;                            $related_contractor_id =  $revenue->related_contractor;                            $related_contractor_name = $revenue->contractor_name;                            $related_company_id =  $revenue->related_company;                            $related_company_name = $revenue->company_name;                            if(!in_array('title', $group_bys)){                                $ledger_title = '*';                                $ledger_account_title_id = '*';                            }                            if(!in_array('ac_type', $group_bys)){                                $ledger_ac_type = '*';                            }                            if(!in_array('related_other_agent', $group_bys)){                                $related_other_agent_id = '*';                                $related_other_agent_name = '*';                                $related_customer_id = '*';                                $related_customer_name = '*';                                $related_contractor_id = '*';                                $related_contractor_name = '*';                                $related_company_id = '*';                                $related_company_name = '*';                            }                            $ledger_query = $this->helper_model->merge_query($_SERVER['QUERY_STRING'],                                array(                                    'ledger_title'=>$ledger_title,                                    'ledger_account_title_id'=>$ledger_account_title_id,                                    'ledger_ac_type'=>$ledger_ac_type,                                    'related_other_agent'=>$related_other_agent_id,                                    'ledger_other_agent_name'=>$related_other_agent_name.'',                                    'related_customer'=>$related_customer_id,                                    'ledger_customer_name'=>$related_customer_name.'',                                    'related_contractor'=>$related_contractor_id,                                    'ledger_contractor_name'=>$related_contractor_name.'',                                    'related_company'=>$related_company_id,                                    'ledger_company_name'=>$related_company_name.''));                            ?>                                <?php                                if(in_array('title', $group_bys)){                                    echo $revenue->title." ";                                }                                if(in_array('ac_type', $group_bys)){                                    echo $revenue->ac_type." ";                                }                                if(in_array('related_other_agent', $group_bys)){                                    echo $revenue->other_agent_name." ";                                }                                if(in_array('related_customer', $group_bys)){                                    echo $revenue->customer_name." ";                                }                                if(in_array('related_contractor', $group_bys)){                                    echo $revenue->contractor_name." ";                                }                                if(in_array('related_company', $group_bys)){                                    echo $revenue->company_name." ";                                }                                /*echo $revenue->title." | ";                                echo $revenue->ac_type." | ";                                echo $revenue->other_agent_name." ";                                echo $revenue->customer_name."";                                echo $revenue->contractor_name."";*/                                ?>                        </td>                        <td><?= (($remaining > 0)?$this->helper_model->money($remaining):''); ?><?= (($remaining == 0)?0:''); ?></td>                        <td><?= (($remaining < 0)?$this->helper_model->money(($remaining * -1)):''); ?><?= (($remaining == 0)?0:''); ?></td>                    </tr>                <?php endforeach; ?>                <tr style="background-color: ">                    <th style="text-align: right;">                        Total Revenue:                    </th>                    <td></td>                    <th>                        <?= (($total_revenue >= 0)?$this->helper_model->money($total_revenue):"(".$this->helper_model->money(($total_revenue)*(-1)).")") ?>                    </th>                </tr>                </tbody>                </table>                </form>                </div>                <div class="col-lg-12">                    <h3>Profit & Loss</h3>                    <div class="text-center">                        <?php                        $remaining = ($total_revenue*-1)-$total_expense;                        if(($remaining)>=0){                            echo "<h3 style='color:green;'>Profit: <span style='font-style:italic;'>".$this->helper_model->money($remaining)."</span></h3>";                        }else{                            echo "<h3 style='color:red;'>Loss: <span style='font-style:italic;'>".$this->helper_model->money(($remaining*(-1)))."</span></h3>";                        }                        ?>                    </div>                </div>                </div>            <?php endif; ?>        </div>    </div></div><script src="<?= js()?>sorttable.js"></script></body></html>